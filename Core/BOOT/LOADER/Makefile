LINKLIST = OUT\ENTRY.AO OUT\VIDEO.AO OUT\DMA.AO OUT\C_ENTRY.OBJ
INCLUDE = ..\..\INCLUDE\

all: OUT\LOADER.SYS

OUT\LOADER.SYS: $(LINKLIST)
	TLINK /x /n /3 /c $(LINKLIST), OUT\LOADER.EXE
	exe2bin -o0:7c00 OUT\LOADER.EXE OUT\LOADER.RAW >nul
	nasm final.asm -o OUT\LOADER.SYS

OUT\C_ENTRY.OBJ: C_ENTRY.C
	TCC -C -G -O -c -I$(INCLUDE) -nOUT C_ENTRY.C

OUT\ENTRY.AO: ENTRY.ASM
	nasm -f obj ENTRY.ASM -o OUT\ENTRY.AO

OUT\VIDEO.AO: VIDEO.ASM
	nasm -f obj VIDEO.ASM -o OUT\VIDEO.AO

OUT\DMA.AO: DMA.ASM
	nasm -I$(INCLUDE) -f obj DMA.ASM -o OUT\DMA.AO

clean:
	del /F    OUT\LOADER.SYS
	del /F /Q OUT\*.AO 2>nul
	del /F /Q OUT\*.OBJ 2>nul
