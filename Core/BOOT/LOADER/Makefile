INCLUDE = ..\..\INCLUDE\

LINKLIST = OUT\ENTRY.AO OUT\VIDEO.AO OUT\DMA_16.AO OUT\C_ENTRY.OBJ \
  OUT\DPRINT.OBJ

all: OUT\LOADER.SYS

OUT\LOADER.SYS: $(LINKLIST)
	TLINK /x /n /3 /c $(LINKLIST), OUT\LOADER.EXE
	exe2bin -o0:7c00 OUT\LOADER.EXE OUT\LOADER.RAW >nul
	nasm -I$(INCLUDE) final.asm -o OUT\LOADER.SYS

OUT\C_ENTRY.OBJ: C_ENTRY.C
	TCC -C -G -O -c -I$(INCLUDE) -nOUT C_ENTRY.C

OUT\DPRINT.OBJ: DPRINT.C
	TCC -C -G -O -c -I$(INCLUDE) -nOUT DPRINT.C

OUT\ENTRY.AO: ENTRY.ASM
	nasm -I$(INCLUDE) -f obj ENTRY.ASM -o OUT\ENTRY.AO

OUT\VIDEO.AO: VIDEO.ASM
	nasm -I$(INCLUDE) -f obj VIDEO.ASM -o OUT\VIDEO.AO

OUT\DMA_16.AO: DMA_16.ASM
	nasm -I$(INCLUDE) -f obj DMA_16.ASM -o OUT\DMA_16.AO

clean:
	del /F    OUT\LOADER.SYS
	del /F /Q OUT\*.AO 2>nul
	del /F /Q OUT\*.OBJ 2>nul
